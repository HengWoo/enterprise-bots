# v0.4.0 Pre-Deployment Checklist

**Version:** 0.4.0
**Date:** 2025-10-26
**Deployment Target:** Production (128.199.175.50)

---

## üîç Pre-Deployment Verification

### 1. Version Consistency ‚úÖ

**Check version numbers across all files:**

- [ ] `pyproject.toml` ‚Üí version = "0.4.0"
- [ ] `Dockerfile` ‚Üí LABEL version="0.4.0"
- [ ] `CLAUDE.md` ‚Üí Multiple version references
- [ ] `IMPLEMENTATION_PLAN.md` ‚Üí Version references

**Verification:**
```bash
grep -rn "version.*0\.4\.0" pyproject.toml Dockerfile
grep -rn "v0\.4\.0" CLAUDE.md IMPLEMENTATION_PLAN.md
```

---

### 2. Configuration Files Validation ‚úÖ

**All 8 bot configs must be valid JSON:**

```bash
# Test JSON syntax for all bot configs
for bot in bots/*.json; do
  echo "Checking $bot..."
  python -m json.tool "$bot" > /dev/null && echo "‚úÖ Valid" || echo "‚ùå Invalid"
done
```

**Critical checks:**
- [ ] All bots have `bot_id`, `bot_key`, `name`, `model_config`
- [ ] All bots use `claude-haiku-4-5-20251001` model
- [ ] Tools configuration matches intended capabilities
- [ ] System prompts are complete and accurate

---

### 3. Dependencies Verification ‚úÖ

**Python dependencies (pyproject.toml):**
- [ ] `fastapi>=0.104.0`
- [ ] `claude-agent-sdk>=0.1.4`
- [ ] `anthropic>=0.39.0`
- [ ] `supabase>=2.0.0`
- [ ] **NEW:** `markitdown[pptx]>=0.0.1`

**System dependencies (Dockerfile):**
- [ ] `pandoc` (for DOCX conversion)
- [ ] `libreoffice` (for PPTX ‚Üí PDF conversion)
- [ ] `poppler-utils` (for PDF ‚Üí image conversion)
- [ ] Node.js 20.x with `@anthropic-ai/claude-code`

**Verification:**
```bash
# Check pyproject.toml dependencies
grep "markitdown" pyproject.toml
grep "supabase" pyproject.toml

# Check Dockerfile system packages
grep -E "pandoc|libreoffice|poppler" Dockerfile
```

---

### 4. Code Syntax Validation ‚úÖ

**Python syntax check:**
```bash
# Compile all Python files to check for syntax errors
find src/ -name "*.py" -exec python -m py_compile {} \;

# Check critical files
python -m py_compile src/app_fastapi.py
python -m py_compile src/campfire_agent.py
python -m py_compile src/bot_manager.py
```

**Expected result:** No output = success

---

### 5. Application Startup Test ‚úÖ

**Test local startup (30 second test):**
```bash
cd /Users/heng/Development/campfire/ai-bot

# Start server in background
PYTHONPATH=$(pwd) TESTING=true CAMPFIRE_URL=https://chat.smartice.ai \
  timeout 30 uv run python src/app_fastapi.py 2>&1 | head -50

# Expected output:
# - "‚úÖ All 31 tool decorators initialized"
# - "Loaded bot: ‰∏™‰∫∫Âä©Êâã (Personal Assistant)"
# - "Loaded bot: Ë¥¢Âä°ÂàÜÊûêÂ∏à (Financial Analyst)"
# - ... (all 8 bots)
# - "INFO:     Uvicorn running on http://0.0.0.0:8000"
# - No Python errors or exceptions
```

---

### 6. Skills MCP Verification ‚úÖ

**Verify Skills directory copied to container:**
```bash
# Check Dockerfile includes .claude/skills/
grep "\.claude/" Dockerfile

# Verify skills exist
ls -la .claude/skills/document-skills-docx/SKILL.md
ls -la .claude/skills/document-skills-pptx/SKILL.md
```

**Expected:**
- ‚úÖ `COPY --chown=appuser:appuser .claude/ ./.claude/` in Dockerfile
- ‚úÖ DOCX skill file exists
- ‚úÖ PPTX skill file exists

---

### 7. Git Status Check ‚úÖ

**Ensure all changes are committed:**
```bash
git status

# Should show:
# - Clean working directory OR
# - Only expected untracked files (test files, cache, etc.)
```

**Files that should be committed:**
- ‚úÖ `bots/personal_assistant.json` (PPTX support added)
- ‚úÖ `pyproject.toml` (markitdown dependency, version 0.4.0)
- ‚úÖ `Dockerfile` (libreoffice, poppler-utils, version 0.4.0)
- ‚úÖ `CLAUDE.md` (documentation updates)
- ‚úÖ `V0.4.0_DOCUMENT_PROCESSING_ARCHITECTURE.md` (new)
- ‚úÖ `V0.4.0_PRE_DEPLOYMENT_CHECKLIST.md` (this file)

**Files that can be ignored:**
- `session_cache/*.json` (test data)
- `test_*.py` (test scripts)
- `.venv/`, `__pycache__/`

---

### 8. Docker Build Test ‚úÖ

**Test Docker build locally (optional but recommended):**
```bash
# Build for linux/amd64 (production platform)
docker buildx build --platform linux/amd64 \
  -t campfire-ai-bot:0.4.0-test \
  --load .

# Expected: Build completes successfully
# Check for warnings about missing dependencies
```

---

### 9. Security Verification ‚úÖ

**Verify security restrictions:**
- [ ] All 8 bots have read-only tool configuration (no Write/Edit/Bash from webhooks)
- [ ] Bash enabled ONLY for personal_assistant (document processing)
- [ ] System prompts include security restrictions
- [ ] Docker runs as non-root user (appuser)

**Check:**
```bash
# Verify only personal_assistant has Bash
grep -l "Bash" bots/*.json

# Should only return: bots/personal_assistant.json
```

---

### 10. Documentation Completeness ‚úÖ

**Verify all documentation is updated:**
- [ ] CLAUDE.md reflects v0.4.0 features
- [ ] DESIGN.md architecture diagrams accurate
- [ ] IMPLEMENTATION_PLAN.md deployment steps current
- [ ] V0.4.0_DOCUMENT_PROCESSING_ARCHITECTURE.md complete
- [ ] No references to deprecated features

---

## üö® Known Issues to Address

### Issue #1: User-Reported Minor Issue
**Status:** ‚è≥ Pending user input
**Description:** User mentioned "another minor issue to fix"
**Action:** Wait for user to describe the issue

---

## ‚úÖ Deployment Readiness Summary

**Before proceeding to deployment, verify ALL items above are checked.**

**Critical Path:**
1. ‚úÖ Version numbers consistent (0.4.0)
2. ‚úÖ All bot configs valid JSON
3. ‚úÖ Dependencies declared (markitdown, libreoffice, poppler-utils)
4. ‚úÖ Code syntax valid
5. ‚úÖ Application starts successfully
6. ‚úÖ Skills MCP files present
7. ‚è≥ Git status clean (commit pending changes)
8. ‚è≥ Docker build test (optional)
9. ‚úÖ Security verified
10. ‚úÖ Documentation complete

**Blockers:**
- ‚ö†Ô∏è User has "another minor issue to fix" - need details

---

## üìã Deployment Commands (When Ready)

**Standard deployment workflow:**

```bash
# 1. Commit all changes
git add <files>
git commit -m "feat: v0.4.0 - Multi-bot collaboration + Document processing (PDF/DOCX/PPTX/Images)"

# 2. Build Docker image
cd /Users/heng/Development/campfire/ai-bot
docker buildx build --platform linux/amd64 \
  -t hengwoo/campfire-ai-bot:0.4.0 \
  -t hengwoo/campfire-ai-bot:latest .

# 3. Push to Docker Hub
docker push hengwoo/campfire-ai-bot:0.4.0
docker push hengwoo/campfire-ai-bot:latest

# 4. Deploy on production server (via DigitalOcean console)
ssh root@128.199.175.50
cd /root/ai-service
docker-compose down
docker pull hengwoo/campfire-ai-bot:latest
docker-compose up -d
docker logs -f campfire-ai-bot

# 5. Verify deployment
curl -s http://localhost:8000/health
# Expected: {"status":"healthy"}

# 6. Test bot response
curl -X POST http://localhost:8000/webhook/personal_assistant \
  -H "Content-Type: application/json" \
  -d '{"creator":{"id":999,"name":"Test"},"room":{"id":999,"name":"Test"},"content":"‰Ω†Â•Ω"}'
```

---

## üéØ Post-Deployment Verification

**After deployment, verify:**
- [ ] All 8 bots respond to @mentions
- [ ] PDF processing works (test with sample PDF)
- [ ] Image processing works (test with sample image)
- [ ] DOCX processing works (test with sample DOCX)
- [ ] PPTX processing works (test with sample PPTX)
- [ ] No errors in Docker logs
- [ ] Monitor for 24-48 hours

---

**Last Updated:** 2025-10-26
**Status:** ‚è≥ Awaiting user's minor issue fix
**Next Step:** User to describe the minor issue, then proceed with checklist
