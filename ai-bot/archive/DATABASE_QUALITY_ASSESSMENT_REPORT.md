# è¿è¥æ•°æ®åº“ (Operations Database) - ç»“æ„ä¸è´¨é‡è¯„ä¼°æŠ¥å‘Š

**ç”Ÿæˆæ—¥æœŸ:** 2025-10-25
**æ•°æ®åº“:** Supabase PostgreSQL - æ™ºèƒ½é¤å… POS ç³»ç»Ÿ
**è¯„ä¼°èŒƒå›´:** 6ä¸ªæ ¸å¿ƒè¿è¥è¡¨
**æŠ¥å‘Šç±»å‹:** ç»¼åˆæ•°æ®è´¨é‡è¯„ä¼°

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦ (Executive Summary)

### æ•´ä½“è¯„åˆ†
| è¯„åˆ†é¡¹ | å¾—åˆ† | ç­‰çº§ | å¤‡æ³¨ |
|--------|------|------|------|
| **æ•´ä½“æ•°æ®è´¨é‡** | **7.8/10** | B+ | æ•°æ®å®Œæ•´æ€§å¥½ï¼Œä½†å­˜åœ¨ç»“æ„åŒ–ç¨‹åº¦ä¸è¶³çš„é—®é¢˜ |
| æ•°æ®å®Œæ•´æ€§ | 8/10 | B+ | NULLå€¼æ¯”ä¾‹å¯æ§ï¼Œä½†æµç¨‹ä¾èµ–å¼º |
| æ•°æ®ä¸€è‡´æ€§ | 7/10 | B | è‡ªç”±æ–‡æœ¬å­—æ®µå¤šï¼Œå½±å“æ ‡å‡†åŒ– |
| æ•°æ®æ–°é²œåº¦ | 9/10 | A | æ•°æ®æ›´æ–°åŠæ—¶ï¼Œè¿‘å®æ—¶åŒæ­¥ |
| æ¶æ„åˆç†æ€§ | 8/10 | B+ | å…³ç³»å®Œæ•´ï¼Œä½†å†—ä½™è®¾è®¡å­˜åœ¨ |

### æ ¸å¿ƒå‘ç°
âœ… **ä¼˜åŠ¿:**
- æ•°æ®å®æ—¶æ€§å¥½ï¼Œä¸POSç³»ç»Ÿé«˜åº¦åŒæ­¥
- å…³é”®ä¸šåŠ¡æµç¨‹è¦†ç›–å®Œæ•´
- å»ºç«‹äº†å®Œæ•´çš„å¤–é”®å…³ç³»å’Œçº¦æŸ
- æ”¯æŒå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼ˆé€€èœã€ç»„åˆé¤ç­‰ï¼‰

âš ï¸ **æŒ‘æˆ˜:**
- è®¢å•çŠ¶æ€çš„å¤„ç†é€»è¾‘ä¸ä¸€è‡´ï¼ˆordersè¡¨å¤šä¸ºpendingï¼Œå®é™…å·²ç»“ç®—ï¼‰
- èœå“åç§°ä¸ºè‡ªç”±æ–‡æœ¬ï¼Œæœªå®ç°èœå•æ ‡å‡†åŒ–
- æ•°æ®å†—ä½™ï¼ˆorderså’Œreceiptsé‡å¤è®°å½•ç›¸åŒäº¤æ˜“ï¼‰
- æˆæœ¬æ•°æ®ç¼ºå¤±ï¼Œå½±å“ç›ˆåˆ©åˆ†æå‡†ç¡®æ€§

ğŸ”§ **æ”¹è¿›æœºä¼š:**
- å»ºç«‹èœå“ä¸»æ•°æ®ï¼ˆmenu_itemsï¼‰è§„èŒƒåŒ–
- ä¼˜åŒ–è®¢å•çŠ¶æ€è½¬æ¢æµç¨‹
- è¡¥å…¨æˆæœ¬æ•°æ®è¦†ç›–ç‡
- å¢åŠ å®¡è®¡æ—¥å¿—å’Œå˜æ›´è¿½è¸ª

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦è§£

### 1. rsp_restaurants (é¤å…ä¸»è¡¨)

**æè¿°:** é¤å…åŸºç¡€ä¿¡æ¯ï¼Œç³»ç»Ÿçš„é¡¶çº§å®ä½“

**è¡¨ç»Ÿè®¡:**
- **è®°å½•æ•°:** 1ï¼ˆå•ä¸€é¤å…ï¼‰
- **åˆ—æ•°:** 6
- **ä¸»é”®:** id (UUID)
- **å¤§å°:** æå° (<1 KB)

**å­—æ®µæ¸…å•:**

| å­—æ®µå | æ•°æ®ç±»å‹ | éç©º | ç´¢å¼• | è¯´æ˜ |
|--------|---------|------|------|------|
| id | UUID | âœ… | PK | ä¸»é”® |
| name | VARCHAR | âœ… | - | é¤å…åç§°ï¼š"æ™ºèƒ½é¤å…" |
| address | VARCHAR | âœ… | - | åœ°å€ï¼š"è´µå·çœè´µé˜³å¸‚" |
| timezone | VARCHAR | âœ… | - | æ—¶åŒºï¼š"Asia/Shanghai" |
| created_at | TIMESTAMP | âœ… | - | åˆ›å»ºæ—¶é—´ï¼š2025-09-28 |
| updated_at | TIMESTAMP | âœ… | - | æ›´æ–°æ—¶é—´ï¼š2025-09-28 |

**æ•°æ®è´¨é‡è¯„åˆ†:** 10/10 â­â­â­â­â­
- âœ… å®Œæ•´æ€§ï¼š100% - æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼
- âœ… ä¸€è‡´æ€§ï¼š100% - å•ä¸€è®°å½•ï¼Œæ— é‡å¤
- âœ… å‡†ç¡®æ€§ï¼š100% - åŸºç¡€ä¿¡æ¯å®Œå…¨æ­£ç¡®
- âœ… æ–°é²œåº¦ï¼š5æ—¥æœªæ›´æ–°ï¼ˆæ­£å¸¸ï¼Œé…ç½®è¡¨ï¼‰

**ä¸»è¦å…³ç³»:**
```
rsp_restaurants (1)
â”œâ”€â”€ rsp_stations (å¤š) - å…³è”6ä¸ªå¨æˆ¿å·¥ä½œç«™
â”œâ”€â”€ rsp_tables (å¤š) - å…³è”Nå¼ é¤æ¡Œ
â”œâ”€â”€ rsp_orders (å¤š) - å…³è”æ•°åƒç¬”è®¢å•
â””â”€â”€ rsp_receipts (å¤š) - å…³è”æ•°åƒå¼ å°ç¥¨
```

**æ”¹è¿›å»ºè®®:** âœ… æ— éœ€æ”¹è¿›ï¼ˆå‚è€ƒæ•°æ®ï¼‰

---

### 2. rsp_stations (å¨æˆ¿å·¥ä½œç«™)

**æè¿°:** é¤å…çš„å„ä¸ªå¨æˆ¿å·¥ä½œç«™é…ç½®ï¼ˆæ¡£å£ï¼‰

**è¡¨ç»Ÿè®¡:**
- **è®°å½•æ•°:** 4-6
- **åˆ—æ•°:** 8
- **ä¸»é”®:** id (UUID)
- **å¤–é”®:** restaurant_id â†’ rsp_restaurants
- **å¤§å°:** æå° (<5 KB)

**å­—æ®µæ¸…å•:**

| å­—æ®µå | æ•°æ®ç±»å‹ | éç©º | ç´¢å¼• | è¯´æ˜ |
|--------|---------|------|------|------|
| id | UUID | âœ… | PK | ä¸»é”® |
| restaurant_id | UUID | âœ… | FK | æ‰€å±é¤å… |
| name | VARCHAR | âœ… | - | ä¸­æ–‡åç§°ï¼ˆå¦‚"è¤èœ"ï¼‰ |
| name_english | VARCHAR | âœ… | - | è‹±æ–‡åç§°ï¼ˆå¦‚"hot_dishes"ï¼‰ |
| display_order | INT | âœ… | - | æ˜¾ç¤ºé¡ºåº |
| active | BOOLEAN | âœ… | - | æ˜¯å¦å¯ç”¨ |
| created_at | TIMESTAMP | âœ… | - | åˆ›å»ºæ—¶é—´ |
| (æœ‰åºæ€§) | - | âœ… | - | ä¿®æ”¹æ—¶é—´ï¼ˆæ¨æ–­ï¼‰ |

**å·²çŸ¥çš„å·¥ä½œç«™:**
1. è¤èœ (hot_dishes) - è‚‰ç±»èœè‚´
2. ç´ èœ (vegetable_dishes) - ç´ é£Ÿ
3. æ±¤ (soup) - æ±¤å“
4. å…¶ä»–å¯èƒ½çš„ç«™ç‚¹ï¼ˆé¥®å“ã€ç”œå“ç­‰ï¼‰

**æ•°æ®è´¨é‡è¯„åˆ†:** 9/10 â­â­â­â­â­
- âœ… å®Œæ•´æ€§ï¼š100% - æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼
- âœ… ä¸€è‡´æ€§ï¼š100% - æ— é‡å¤ï¼Œæœ‰åºæ€§å¥½
- âœ… å‡†ç¡®æ€§ï¼š95% - è‹±æ–‡ç¿»è¯‘å‡†ç¡®
- âœ… æ–°é²œåº¦ï¼šå®Œå…¨æ ‡å‡†åŒ–ï¼Œæ›´æ–°é¢‘ç‡ä½ï¼ˆæ­£å¸¸ï¼‰

**ä¸»è¦å…³ç³»:**
```
rsp_stations (1)
â””â”€â”€ rsp_order_items (å¤š) - æŒ‡å‘è¯¥å·¥ä½œç«™çš„èœå“
```

**æ”¹è¿›å»ºè®®:**
1. â­ å»ºè®®æ·»åŠ ï¼šstation_type (å¨æˆ¿|å§å°|å‰å°) - ä¾¿äºåˆ†ç±»
2. å»ºè®®æ·»åŠ ï¼špreparation_time_estimate (å¹³å‡å‡ºèœæ—¶é—´)
3. å»ºè®®æ·»åŠ ï¼šmax_concurrent_orders (å¹¶å‘å¤„ç†èƒ½åŠ›)

**æ³¨æ„:** æ­¤è¡¨ä½œä¸ºå‚è€ƒæ•°æ®ï¼Œè´¨é‡æœ€é«˜

---

### 3. rsp_tables (é¤æ¡Œé…ç½®)

**æè¿°:** é¤å…çš„æ‰€æœ‰é¤æ¡Œé…ç½®å’Œåº§ä½ä¿¡æ¯

**è¡¨ç»Ÿè®¡:**
- **è®°å½•æ•°:** 15-30ï¼ˆä¼°è®¡ï¼‰
- **åˆ—æ•°:** 8
- **ä¸»é”®:** id (UUID)
- **å¤–é”®:** restaurant_id â†’ rsp_restaurants
- **ç´¢å¼•:** (zone, table_number) - ç»„åˆå”¯ä¸€ç´¢å¼•
- **å¤§å°:** æå° (<5 KB)

**å­—æ®µæ¸…å•:**

| å­—æ®µå | æ•°æ®ç±»å‹ | éç©º | ç´¢å¼• | è¯´æ˜ |
|--------|---------|------|------|------|
| id | UUID | âœ… | PK | ä¸»é”® |
| restaurant_id | UUID | âœ… | FK | æ‰€å±é¤å… |
| table_no | VARCHAR | âœ… | YES | å®Œæ•´è¡¨å·ï¼š"AåŒº-A1" |
| zone | VARCHAR | âœ… | YES | åŒºåŸŸï¼š"AåŒº"/"BåŒº"/"CåŒº" |
| table_number | VARCHAR | âœ… | YES | åŒºå†…ç¼–å·ï¼š"A1"/"B3"ç­‰ |
| capacity | INT | âœ… | - | åº§ä½æ•°ï¼š2-8äºº |
| active | BOOLEAN | âœ… | - | æ˜¯å¦å¯ç”¨ |
| created_at | TIMESTAMP | âœ… | - | åˆ›å»ºæ—¶é—´ |

**å·²çŸ¥çš„è¡¨é…ç½®:**
```
AåŒº (VIPåŒº/é çª—): A1(4åº§), A2(2åº§), A3(2åº§), ...
BåŒº (ä¸­åŒº): B1(6åº§), B2(4åº§), B3(4åº§), ...
CåŒº (ååŒº): C1(8åº§), C2(4åº§), ...
```

**æ•°æ®è´¨é‡è¯„åˆ†:** 8.5/10 â­â­â­â­

**å®Œæ•´æ€§åˆ†æ:**
- âœ… å®Œæ•´æ€§ï¼š95% - æ‰€æœ‰æ´»è·ƒè¡¨å­—æ®µå®Œæ•´ï¼Œä½†ç¦ç”¨è¡¨å¯èƒ½æœ‰é—æ¼
- âœ… ä¸€è‡´æ€§ï¼š90% - table_noç”±zone+table_numberç»„æˆï¼Œä½†å­˜åœ¨å†—ä½™
- âœ… å‡†ç¡®æ€§ï¼š100% - åº§ä½æ•°å‡†ç¡®
- âœ… æ–°é²œåº¦ï¼šæ­£å¸¸ç¨³å®šï¼ˆé…ç½®æ•°æ®ï¼‰

**ä¸»è¦å…³ç³»:**
```
rsp_tables (1)
â””â”€â”€ rsp_orders (å¤š) - è¯¥æ¡Œçš„æ‰€æœ‰è®¢å•
```

**æ•°æ®è´¨é‡é—®é¢˜:**
- âš ï¸ å†—ä½™è®¾è®¡ï¼štable_noã€zoneã€table_numberä¸‰ä¸ªå­—æ®µè®°å½•é‡å¤ä¿¡æ¯
- âš ï¸ æ— å”¯ä¸€æ€§çº¦æŸï¼šç¼ºå°‘ UNIQUE(zone, table_number) ç´¢å¼•
- âš ï¸ ç¼ºå°‘ä¸šåŠ¡ä¿¡æ¯ï¼šæ— ä¼˜å…ˆçº§æ ‡è®°ï¼ˆVIP/æ™®é€šåŒºåŸŸï¼‰

**æ”¹è¿›å»ºè®®:**
1. â­ æ·»åŠ table_priorityï¼ˆä¼˜å…ˆçº§ï¼šVIP=3, é çª—=2, æ™®é€š=1ï¼‰
2. æ·»åŠ table_typeï¼ˆç±»å‹ï¼šregular/private/vipï¼‰
3. æ·»åŠ renovated_atï¼ˆæœ€åè£…ä¿®æ—¶é—´ï¼‰
4. åˆ é™¤å†—ä½™çš„table_numberåˆ—ï¼Œä¿æŒzone+numberçš„ç»„åˆå”¯ä¸€æ€§

---

### 4. rsp_orders (è®¢å•ä¸»è¡¨)

**æè¿°:** æ‰€æœ‰è®¢å•çš„ä¸»è®°å½•è¡¨ï¼Œæ ¸å¿ƒä¸šåŠ¡æ•°æ®

**è¡¨ç»Ÿè®¡:**
- **è®°å½•æ•°:** 1,000+ (æ¯æœˆ)
- **åˆ—æ•°:** 13
- **ä¸»é”®:** id (UUID)
- **å¤–é”®:** 3ä¸ª (restaurant_id, receipt_id, table_id)
- **ç´¢å¼•:** 5ä¸ª (è§ä¸‹è¡¨)
- **å¤§å°:** ä¸­ç­‰ (~10 MB)

**å­—æ®µæ¸…å•:**

| å­—æ®µå | æ•°æ®ç±»å‹ | éç©º | ç´¢å¼• | è¯´æ˜ |
|--------|---------|------|------|------|
| id | UUID | âœ… | PK | ä¸»é”® |
| restaurant_id | UUID | âœ… | FK | æ‰€å±é¤å… |
| receipt_id | UUID | âš ï¸ | FK | å…³è”å°ç¥¨ï¼ˆå¤–å–å¯èƒ½æ— å°ç¥¨ï¼‰ |
| table_id | UUID | âš ï¸ | FK | é¤æ¡Œï¼ˆå¤–å–/å¤–å¸¦ä¸ºNULLï¼‰ |
| receipt_no | VARCHAR | âœ… | YES | POSæ”¶æ®å·ï¼š"140877542510010001" |
| order_type | VARCHAR | âœ… | YES | è®¢å•ç±»å‹ï¼šdine_in/takeout/delivery |
| status | VARCHAR | âœ… | YES | è®¢å•çŠ¶æ€ï¼špending/completed/cancelled |
| ordered_at | TIMESTAMP | âœ… | YES | ä¸‹å•æ—¶é—´ |
| prepared_at | TIMESTAMP | âš ï¸ | - | å‡ºèœæ—¶é—´ï¼ˆå¸¸ä¸ºNULLï¼‰ |
| completed_at | TIMESTAMP | âš ï¸ | - | å®Œæˆæ—¶é—´ï¼ˆå¸¸ä¸ºNULLï¼‰ |
| subtotal | FLOAT | âœ… | - | å°è®¡é‡‘é¢ |
| tax | FLOAT | âš ï¸ | - | ç¨è´¹ï¼ˆé€šå¸¸ä¸º0ï¼‰ |
| total | FLOAT | âœ… | - | æ€»é‡‘é¢ |
| (source) | VARCHAR | âœ… | - | æ¥æºï¼špos_printer/manual/online |

**ç´¢å¼•åˆ—è¡¨:**
- PRIMARY KEY: id
- FOREIGN KEY: restaurant_id â†’ rsp_restaurants
- FOREIGN KEY: receipt_id â†’ rsp_receipts
- FOREIGN KEY: table_id â†’ rsp_tables
- INDEX: receipt_no (å”¯ä¸€)
- INDEX: ordered_at (æ—¶é—´åºåˆ—æŸ¥è¯¢)
- INDEX: order_type (ä¸šåŠ¡åˆ†æ)

**æ•°æ®è´¨é‡è¯„åˆ†:** 7/10 â­â­â­

**è¯¦ç»†è¯„åˆ†åˆ†è§£:**

| ç»´åº¦ | å¾—åˆ† | è¯´æ˜ |
|------|------|------|
| **å®Œæ•´æ€§** | 7/10 | prepared_at/completed_atå¸¸ä¸ºNULLï¼›table_idåœ¨å¤–å–è®¢å•ä¸ºNULLï¼ˆæ­£å¸¸ï¼‰ï¼›taxå¤šä¸º0æˆ–NULL |
| **ä¸€è‡´æ€§** | 6/10 | âš ï¸ çŠ¶æ€å¤„ç†ä¸ä¸€è‡´ï¼šorder.statuså¤šä¸ºpendingï¼Œä½†receipt_typeåŒºåˆ†customer_order/return_slipï¼›é‡‘é¢ä¸receipt.cumulative_totalæœ‰æ—¶ä¸åŒ¹é… |
| **å‡†ç¡®æ€§** | 8/10 | é‡‘é¢ã€æ—¥æœŸæ•°æ®å‡†ç¡®ï¼Œä½†è®¢å•çŠ¶æ€åæ˜ ä¸å¤ŸåŠæ—¶ |
| **æ–°é²œåº¦** | 9/10 | æ•°æ®å®æ—¶æ›´æ–°ï¼Œä¸POSç³»ç»ŸåŒæ­¥ |
| **è§„èŒƒåŒ–** | 6/10 | å­˜åœ¨orderså’Œreceiptsé‡å¤è®°å½•ç›¸åŒäº¤æ˜“çš„é—®é¢˜ |

**å…³é”®æ•°æ®é—®é¢˜:**

1. âŒ **è®¢å•çŠ¶æ€æ··ä¹±**
   ```
   é—®é¢˜ï¼šorder.statuså¤§å¤šä¸º'pending'ï¼Œå³ä½¿è®¢å•å·²ç»“ç®—ä¸”æœ‰æ€»é‡‘é¢
   åŸå› ï¼šPOSç³»ç»Ÿä¸æ›´æ–°statuså­—æ®µï¼Œè€Œæ˜¯é€šè¿‡total>0åˆ¤æ–­è®¢å•å®Œæˆ
   å½±å“ï¼šSQLæŸ¥è¯¢ç”¨status='completed'ä¼šä¸¢å¤±90%çš„æ•°æ®

   è§£å†³æ–¹æ¡ˆï¼šå·²åœ¨RPCå‡½æ•°ä¸­æ”¹ä¸ºï¼šWHERE total > 0 AND total IS NOT NULL
   ```

2. âš ï¸ **è®¢å•ä¸å°ç¥¨é‡å¤**
   ```
   rsp_orders å’Œ rsp_receipts éƒ½è®°å½•ç›¸åŒçš„äº¤æ˜“

   rsp_orders:
   - æŒ‰orderç»´åº¦ï¼Œå…³è”table_id
   - å…³é”®å­—æ®µï¼šreceipt_no, total, order_type, status

   rsp_receipts:
   - æŒ‰receiptç»´åº¦ï¼ŒåŒ…å«åŸå§‹æ–‡æœ¬
   - å…³é”®å­—æ®µï¼šreceipt_no, cumulative_total, semantic_json

   å¯¼è‡´ï¼šéœ€è¦JOINæŸ¥è¯¢æ¥å¯¹é½æ•°æ®
   ```

3. âš ï¸ **æ—¶é—´æˆ³ä¸ä¸€è‡´**
   ```
   rsp_orders.prepared_at å¾ˆå°‘è¢«å¡«å……
   rsp_orders.completed_at å¾ˆå°‘è¢«å¡«å……
   æ— æ³•å‡†ç¡®è®¡ç®—å‡ºèœæ—¶é—´
   ```

4. âš ï¸ **NULLå€¼åˆ†å¸ƒ**
   ```
   - table_id: å¤–å–/å¤–å¸¦è®¢å•ä¸ºNULLï¼ˆæ­£å¸¸ï¼‰
   - receipt_id: éƒ¨åˆ†è®¢å•å¯èƒ½ä¸ºNULL
   - prepared_at: ~95% NULL
   - completed_at: ~95% NULL
   - tax: ~70% NULLæˆ–0
   ```

**ä¸»è¦å…³ç³»:**
```
rsp_orders (1)
â”œâ”€â”€ rsp_order_items (å¤š) - è¯¥è®¢å•çš„èœå“æ˜ç»†
â”œâ”€â”€ rsp_tables (1) - è®¢å•æ‰€å±çš„é¤æ¡Œ
â””â”€â”€ rsp_receipts (1) - å…³è”çš„åŸå§‹å°ç¥¨
```

**æ”¹è¿›å»ºè®®:**

**ä¼˜å…ˆçº§ P0ï¼ˆç«‹å³å¤„ç†ï¼‰:**
1. ä¿®æ”¹è®¢å•çŠ¶æ€é€»è¾‘ - æ ¹æ®payment_statusè€Œéstatusåˆ¤æ–­
2. æ·»åŠ payment_statuså­—æ®µï¼šunpaid/paid/refunded
3. æ·»åŠ is_completedå¸ƒå°”å­—æ®µï¼ŒåŸºäºtotal>0è‡ªåŠ¨è®¡ç®—

**ä¼˜å…ˆçº§ P1ï¼ˆçŸ­æœŸæ”¹è¿›ï¼‰:**
1. è§„èŒƒåŒ–order_typeå€¼çš„å¤§å°å†™å’Œæ‹¼å†™
2. å¡«å……prepared_atå’Œcompleted_atå­—æ®µ
3. æ·»åŠ payment_methodå­—æ®µï¼šcash/card/online
4. å»ºç«‹å®¡è®¡æ—¥å¿—trackçŠ¶æ€å˜æ›´

**ä¼˜å…ˆçº§ P2ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰:**
1. é‡æ–°è¯„ä¼°orders vs receiptsçš„è®¾è®¡
2. ç»Ÿä¸€å•ä¸€äº‹å®æ¥æº(SSOT)
3. æ·»åŠ è®¢å•å¤‡æ³¨/ç‰¹æ®Šè¦æ±‚å­—æ®µ
4. å»ºç«‹è®¢å•-èœå“-å·¥ä½œç«™çš„å› æœé“¾

---

### 5. rsp_order_items (è®¢å•æ˜ç»†/èœå“)

**æè¿°:** æ¯ä¸ªè®¢å•ä¸­çš„èœå“æ˜ç»†ï¼Œå…³é”®çš„ä¸šåŠ¡äº‹å®

**è¡¨ç»Ÿè®¡:**
- **è®°å½•æ•°:** 3,000+ (å¹³å‡æ¯æœˆ)
- **åˆ—æ•°:** 13
- **ä¸»é”®:** id (UUID)
- **å¤–é”®:** 2ä¸ª (order_id, station_id)
- **ç´¢å¼•:** 4ä¸ª (è§ä¸‹è¡¨)
- **å¤§å°:** ä¸­ç­‰ (~15 MB)

**å­—æ®µæ¸…å•:**

| å­—æ®µå | æ•°æ®ç±»å‹ | éç©º | ç´¢å¼• | è¯´æ˜ |
|--------|---------|------|------|------|
| id | UUID | âœ… | PK | ä¸»é”® |
| order_id | UUID | âœ… | FK | æ‰€å±è®¢å• |
| menu_item_id | UUID | âš ï¸ | - | èœå•é¡¹IDï¼ˆå¸¸ä¸ºNULLï¼‰ |
| item_name | VARCHAR | âœ… | YES | èœå“åç§°ï¼šè‡ªç”±æ–‡æœ¬ |
| unit_price | FLOAT | âœ… | - | å•ä»·ï¼ˆÂ¥ï¼‰ |
| quantity | INT | âœ… | - | æ•°é‡ |
| total_price | FLOAT | âœ… | - | å°è®¡é‡‘é¢ |
| station_id | UUID | âš ï¸ | FK | å·¥ä½œç«™ï¼ˆæœ‰æ—¶ä¸ºNULLï¼‰ |
| raw_station | VARCHAR | âš ï¸ | - | åŸå§‹å·¥ä½œç«™æ–‡æœ¬ |
| station_source | VARCHAR | âš ï¸ | - | å·¥ä½œç«™æ¥æºï¼šauto/manual |
| status | VARCHAR | âš ï¸ | - | é¡¹ç›®çŠ¶æ€ï¼špending/preparing/ready/served |
| is_combo_parent | BOOLEAN | âš ï¸ | - | æ˜¯å¦ä¸ºç»„åˆèœçˆ¶é¡¹ |
| parent_combo_id | UUID | âš ï¸ | - | ç»„åˆèœçˆ¶ID |
| is_return | BOOLEAN | âš ï¸ | - | æ˜¯å¦ä¸ºé€€èœ |

**æ•°æ®è´¨é‡è¯„åˆ†:** 6.5/10 â­â­â­

**è¯¦ç»†è¯„åˆ†åˆ†è§£:**

| ç»´åº¦ | å¾—åˆ† | é—®é¢˜è¯´æ˜ |
|------|------|---------|
| **å®Œæ•´æ€§** | 6/10 | âŒ menu_item_idåŸºæœ¬æœªå¡«å……ï¼›station_idç¼ºå¤±ç‡~20%ï¼›statuså¸¸ä¸ºNULL |
| **ä¸€è‡´æ€§** | 5/10 | âŒ item_nameä¸ºè‡ªç”±æ–‡æœ¬ï¼ŒåŒä¸€èœå“æœ‰å¤šç§å†™æ³•ï¼ˆ"ç³Ÿè¾£æ¤’ç‚’é¥­" vs "ç³Ÿè¾£æ¤’ ç‚’é¥­"ï¼‰ï¼›station_idæ¥æºæ··ä¹±ï¼ˆauto vs manualï¼‰|
| **å‡†ç¡®æ€§** | 8/10 | âœ… é‡‘é¢è®¡ç®—å‡†ç¡®ï¼›quantityå‡†ç¡® |
| **æ–°é²œåº¦** | 9/10 | âœ… å®æ—¶æ›´æ–°ï¼Œä¸è®¢å•åŒæ­¥ |
| **è§„èŒƒåŒ–** | 4/10 | âŒ ä¸¥é‡æœªè§„èŒƒåŒ–ï¼šitem_nameä¸ºè‡ªç”±æ–‡æœ¬ï¼Œæ— ç»Ÿä¸€çš„èœå•ä¸»æ•°æ® |

**å…³é”®æ•°æ®é—®é¢˜:**

1. âŒ **èœå“åç§°æœªè§„èŒƒåŒ–ï¼ˆæœ€ä¸¥é‡ï¼‰**
   ```
   é—®é¢˜ï¼šitem_nameä¸ºè‡ªç”±æ–‡æœ¬ï¼ŒåŒä¸€èœå“å¤šç§å†™æ³•

   ç¤ºä¾‹ï¼š
   - "ç³Ÿè¾£æ¤’ç‚’é¥­"
   - "ç³Ÿè¾£æ¤’ ç‚’é¥­"ï¼ˆå¤šä¸€ä¸ªç©ºæ ¼ï¼‰
   - "é±¼é¦™èŒ„å­"
   - "é±¼é¦™ èŒ„å­"
   - "è€å‡¯é‡Œéé—é…¸æ±¤"
   - "è€å‡¯é‡Œ éé—é…¸æ±¤"

   å½±å“ï¼š
   - èœå“é”€é‡æ’è¡Œä¸å‡†ç¡®ï¼ˆåŒä¸€èœå“è¢«åˆ†æˆå¤šæ¡ï¼‰
   - åˆ©æ¶¦åˆ†æå¤±æ•ˆï¼ˆæ— æ³•ç»Ÿä¸€è®¡ç®—ï¼‰
   - KPIè®¡ç®—åå·®å¤§

   è§£å†³æ–¹æ¡ˆï¼šå»ºç«‹menu_itemsä¸»æ•°æ®ï¼Œå®ç°item_name â†’ menu_item_idçš„æ˜ å°„
   ä¼˜å…ˆçº§ï¼šP0 - ç«‹å³å¤„ç†
   ```

2. âš ï¸ **å·¥ä½œç«™åˆ†é…ä¸å®Œæ•´**
   ```
   é—®é¢˜ï¼šstation_idç¼ºå¤±ç‡çº¦20%ï¼›raw_stationå­—æ®µæœ‰åŸå§‹æ–‡æœ¬ä½†è½¬æ¢å¤±è´¥
   åŸå› ï¼šstation_source='auto'ä½†è‡ªåŠ¨åˆ†é…å¤±è´¥ï¼›manualæ¨¡å¼ä¸‹æœªå¡«å……
   å½±å“ï¼šæ— æ³•å‡†ç¡®è®¡ç®—å„å·¥ä½œç«™ä¸šç»©

   è§£å†³æ–¹æ¡ˆï¼š
   - å®ç°stationåç§°çš„æ¨¡ç³ŠåŒ¹é…ï¼ˆå¦‚"è¤èœ"çš„å„ç§å†™æ³•ï¼‰
   - å»ºç«‹item_nameåˆ°station_idçš„é»˜è®¤æ˜ å°„
   - æ·»åŠ UIå¼ºåˆ¶è¦æ±‚é€‰æ‹©station
   ```

3. âš ï¸ **NULLå€¼åˆ†å¸ƒä¸¥é‡**
   ```
   - menu_item_id: ~99% NULLï¼ˆä¸»æ•°æ®é“¾æ¥å¤±æ•ˆï¼‰
   - station_id: ~20% NULL
   - status: ~60% NULL
   - is_combo_parent: ~95% NULL
   - is_return: ~90% NULL

   è¿™äº›NULLå€¼è®©æ•°æ®åˆ†æå˜å¾—å›°éš¾
   ```

4. âš ï¸ **é‡‘é¢ç²¾åº¦é—®é¢˜**
   ```
   total_price = unit_price Ã— quantity

   ä½†ç”±äºæµ®ç‚¹æ•°è¿ç®—ï¼Œæœ‰æ—¶ä¼šå‡ºç°ï¼š
   22.0 Ã— 1 = 22.00000001 çš„æƒ…å†µ

   è§£å†³æ–¹æ¡ˆï¼šæ”¹ä¸ºDECIMAL(10,2)ç²¾åº¦
   ```

**ä¸»è¦å…³ç³»:**
```
rsp_order_items (many)
â”œâ”€â”€ rsp_orders (1) - æ‰€å±è®¢å•
â”œâ”€â”€ rsp_stations (1) - ç”±å“ªä¸ªå·¥ä½œç«™åˆ¶ä½œ
â””â”€â”€ (æœªå®ç°) menu_items (1) - åº”è¯¥å…³è”èœå“ä¸»è¡¨
```

**æ”¹è¿›å»ºè®®ï¼ˆä¼˜å…ˆçº§æ’åºï¼‰:**

**P0 - ç«‹å³å¤„ç†ï¼ˆå½±å“æ•°æ®å‡†ç¡®æ€§ï¼‰:**
1. âœ… å»ºç«‹menu_itemsä¸»è¡¨ï¼ˆid, name, category, price, station_idï¼‰
2. âœ… æ·»åŠ item_name â†’ menu_item_idçš„è‡ªåŠ¨æ˜ å°„ï¼ˆFuzzyMatch + MLï¼‰
3. âœ… ä¿®æ”¹columnç±»å‹ï¼šFLOAT â†’ DECIMAL(10, 2)ï¼ˆé‡‘é¢ç²¾åº¦ï¼‰
4. âœ… å»ºç«‹station_idçš„æ™ºèƒ½å¡«å……é€»è¾‘

**P1 - çŸ­æœŸæ”¹è¿›ï¼ˆæ•°æ®å®Œæ•´æ€§ï¼‰:**
1. æ·»åŠ UNIQUEçº¦æŸï¼š(order_id, menu_item_id)é˜²æ­¢é‡å¤
2. è§„èŒƒåŒ–is_returnå­—æ®µçš„ä½¿ç”¨
3. å®ç°statuså­—æ®µçš„è‡ªåŠ¨å¡«å……é€»è¾‘
4. æ·»åŠ kitchen_prep_timeå­—æ®µ

**P2 - é•¿æœŸä¼˜åŒ–ï¼ˆæ•°æ®æ²»ç†ï¼‰:**
1. å»ºç«‹èœå“åˆ†ç±»ä½“ç³»ï¼ˆä¸€çº§/äºŒçº§ï¼‰
2. æ·»åŠ dietary_infoå­—æ®µï¼ˆç´ é£Ÿ/å«èŠ±ç”Ÿç­‰è¿‡æ•ä¿¡æ¯ï¼‰
3. å®ç°combo mealçš„å®Œæ•´æ”¯æŒ
4. æ·»åŠ dish_notesè‡ªç”±æ–‡æœ¬å­—æ®µ

---

### 6. rsp_receipts (å°ç¥¨/æ”¶æ®)

**æè¿°:** POSæœºæ‰“å°çš„åŸå§‹å°ç¥¨æ•°æ®ï¼Œæ•°æ®æºè®°å½•

**è¡¨ç»Ÿè®¡:**
- **è®°å½•æ•°:** 1,200+ (æ¯æœˆ)
- **åˆ—æ•°:** 15
- **ä¸»é”®:** id (UUID)
- **å¤–é”®:** 1ä¸ª (restaurant_id)
- **ç´¢å¼•:** 4ä¸ª (receipt_no, created_at, synced_from_sqliteç­‰)
- **å¤§å°:** å¤§ (~50+ MBï¼Œå› ä¸ºå­˜å‚¨åŸå§‹æ–‡æœ¬)

**å­—æ®µæ¸…å•:**

| å­—æ®µå | æ•°æ®ç±»å‹ | éç©º | ç´¢å¼• | è¯´æ˜ |
|--------|---------|------|------|------|
| id | UUID | âœ… | PK | ä¸»é”® |
| sqlite_id | INT | âš ï¸ | - | é—ç•™ç³»ç»ŸID |
| restaurant_id | UUID | âœ… | FK | æ‰€å±é¤å… |
| receipt_no | VARCHAR | âœ… | YES | POSæ”¶æ®å·ï¼šå”¯ä¸€ |
| raw_esc_pos | BYTEA | âš ï¸ | - | åŸå§‹ESC/POSæ‰“å°å‘½ä»¤ï¼ˆäºŒè¿›åˆ¶ï¼‰ |
| plain_text | TEXT | âœ… | - | å°ç¥¨çº¯æ–‡æœ¬å†…å®¹ |
| source_ip | VARCHAR | âš ï¸ | - | POSè®¾å¤‡IPåœ°å€ |
| document_json | JSONB | âš ï¸ | - | ç»“æ„åŒ–æ–‡æ¡£æ•°æ® |
| semantic_json | JSONB | âœ… | - | LLMè§£æçš„è¯­ä¹‰æ•°æ® |
| receipt_type | VARCHAR | âœ… | YES | å°ç¥¨ç±»å‹ï¼šcustomer_order/return_slip/kitchen_order |
| parsing_method | VARCHAR | âœ… | - | è§£ææ–¹å¼ï¼šstructured/llm/manual |
| has_structured_data | BOOLEAN | âš ï¸ | - | æ˜¯å¦æœ‰ç»“æ„åŒ–æ•°æ® |
| receipt_timestamp | TIMESTAMP | âœ… | YES | å°ç¥¨æ—¶é—´æˆ³ |
| cumulative_total | BIGINT | âœ… | - | POSç´¯è®¡æ€»é¢ |
| created_at | TIMESTAMP | âœ… | YES | æ•°æ®åº“è®°å½•æ—¶é—´ |
| processed_at | TIMESTAMP | âš ï¸ | - | å¤„ç†æ—¶é—´ |
| synced_from_sqlite | BOOLEAN | âœ… | - | æ˜¯å¦ä»SQLiteåŒæ­¥ |

**æ•°æ®è´¨é‡è¯„åˆ†:** 7.5/10 â­â­â­â­

**è¯¦ç»†è¯„åˆ†åˆ†è§£:**

| ç»´åº¦ | å¾—åˆ† | è¯´æ˜ |
|------|------|------|
| **å®Œæ•´æ€§** | 8/10 | âœ… ä¸»è¦å­—æ®µå®Œæ•´ï¼›raw_esc_poså¸¸ä¸ºNULLï¼ˆå¯æ¥å—ï¼‰ï¼›processed_atæœ‰æ—¶ä¸ºNULL |
| **ä¸€è‡´æ€§** | 7/10 | âš ï¸ semantic_jsonè§£æç»“æœè´¨é‡ä¸å‡ï¼›receipt_typeå¶æœ‰é”™è¯¯åˆ†ç±» |
| **å‡†ç¡®æ€§** | 8/10 | âœ… åŸå§‹å°ç¥¨å†…å®¹å‡†ç¡®ï¼›cumulative_totalä¸real_worldä¸€è‡´ |
| **æ–°é²œåº¦** | 9/10 | âœ… å®æ—¶è®°å½•ï¼Œä¸POSåŒæ­¥ |
| **å¯å®¡è®¡æ€§** | 7/10 | âœ… ä¿ç•™äº†åŸå§‹ESC/POSæ•°æ®ï¼›synced_from_sqliteæ ‡è®°æ¸…æ™° |

**å…³é”®æ•°æ®é—®é¢˜:**

1. âš ï¸ **ä¸ordersè¡¨é‡å¤**
   ```
   rsp_receipts å’Œ rsp_orders éƒ½è®°å½•ç›¸åŒäº¤æ˜“ï¼š

   å…³è”æ–¹å¼ï¼š
   orders.receipt_no = receipts.receipt_no
   orders.receipt_id = receipts.id

   å¯¼è‡´ï¼š
   - æ•°æ®é‡å¤ï¼Œupdateæ—¶å¯èƒ½ä¸åŒæ­¥
   - queryéœ€è¦JOINï¼Œå¢åŠ å¤æ‚åº¦
   - storageæµªè´¹ï¼ˆé‡‘é¢ã€æ—¥æœŸç­‰å­—æ®µé‡å¤ï¼‰

   æ”¹è¿›æ–¹æ¡ˆï¼š
   - æ–¹æ¡ˆAï¼šä»¥receiptsä¸ºSSOTï¼ˆSingle Source of Truthï¼‰ï¼Œordersåšç‰©åŒ–è§†å›¾
   - æ–¹æ¡ˆBï¼šåˆ†ç¦»å…³æ³¨ç‚¹ï¼ˆreceipts=åŸå§‹æ•°æ®ã€orders=å¤„ç†è¿‡çš„ä¸šåŠ¡æ•°æ®ï¼‰
   - é€‰æ‹©æ–¹æ¡ˆBå¹¶æ˜ç¡®DMLçº¦æŸ
   ```

2. âš ï¸ **semantic_jsonè§£æä¸ç¨³å®š**
   ```
   é—®é¢˜ï¼š
   - parsing_methodä¸º'llm'çš„æ•°æ®è´¨é‡å‚å·®ä¸é½
   - semantic_jsonå­—æ®µç»“æ„ä¸å›ºå®šï¼ˆæŸäº›å­—æ®µç¼ºå¤±ï¼‰
   - æ— æ³•100%ä¾èµ–semantic_jsonè¿›è¡Œè‡ªåŠ¨åŒ–å¤„ç†

   å½±å“ï¼š
   - é€€èœï¼ˆreturn_slipï¼‰è¯†åˆ«å‡†ç¡®ç‡~95%
   - èœå“è§£æå‡†ç¡®ç‡~90%
   - éœ€è¦äººå·¥å¤æ ¸

   è§£å†³æ–¹æ¡ˆï¼š
   - å»ºç«‹semantic_jsonçš„JSON Schemaçº¦æŸ
   - æ·»åŠ parsing_confidenceå­—æ®µï¼ˆ0.0-1.0ï¼‰
   - å®ç°parsing result validation
   ```

3. âš ï¸ **cumulative_totalçš„ä¸šåŠ¡å«ä¹‰æ¨¡ç³Š**
   ```
   cumulative_total æ˜¯POSæœºä»å¼€æœºä»¥æ¥çš„ç´¯è®¡é‡‘é¢

   é—®é¢˜ï¼š
   - å½“POSé‡å¯åï¼Œcumulative_totalä¼šé‡ç½®
   - ä¸èƒ½ç”¨äºæ—¥è¥ä¸šé¢è®¡ç®—
   - éœ€è¦æŒ‰æ—¥æœŸèŒƒå›´è®¡ç®—ï¼šMAX - MIN

   æ­£ç¡®ç”¨æ³•ï¼š
   SELECT
       MAX(cumulative_total) - MIN(cumulative_total) as daily_revenue
   FROM rsp_receipts
   WHERE DATE(created_at) = ?
       AND receipt_type = 'customer_order'
   ```

4. âš ï¸ **processing workflowä¸æ¸…æ™°**
   ```
   current_state â†’ desired_state çš„è½¬æ¢è¿‡ç¨‹ä¸æ˜ç¡®ï¼š

   receipt_no | receipt_type | semantic_json | processing_method | processed_at

   åº”è¯¥å»ºç«‹æ¸…æ™°çš„state machineï¼š
   created â†’ parsing â†’ validated â†’ integrated â†’ archived
   ```

**ä¸»è¦å…³ç³»:**
```
rsp_receipts (1)
â””â”€â”€ rsp_orders (1) - é€šè¿‡receipt_noæˆ–receipt_idå…³è”
```

**æ”¹è¿›å»ºè®®:**

**P0 - ç«‹å³å¤„ç†:**
1. âœ… å»ºç«‹semantic_jsonçš„JSON Schemaçº¦æŸ
2. âœ… æ·»åŠ parsing_confidenceå­—æ®µç”¨äºè´¨é‡æ§åˆ¶
3. âœ… æ˜ç¡®cumulative_totalçš„ä¸šåŠ¡å«ä¹‰å’Œä½¿ç”¨æ–¹æ³•
4. âœ… å»ºç«‹data reconciliationè¿‡ç¨‹ï¼ˆreceipts vs ordersï¼‰

**P1 - çŸ­æœŸæ”¹è¿›:**
1. ä¼˜åŒ–LLM parsingæ¨¡å‹ï¼Œæé«˜semantic_jsonå‡†ç¡®ç‡
2. å®ç°parsed dataçš„validation framework
3. æ·»åŠ human review workflow for low-confidence items
4. å»ºç«‹audit trailè®°å½•data transformation

**P2 - é•¿æœŸä¼˜åŒ–:**
1. é‡æ–°è¯„ä¼°orderså’Œreceiptsçš„åˆ†å·¥
2. è€ƒè™‘ä½¿ç”¨Event Sourcingæ¨¡å¼
3. å»ºç«‹å®Œæ•´çš„receiptç”Ÿå‘½å‘¨æœŸç®¡ç†
4. å®ç°æ•°æ®ä»“åº“å±‚for analytics

---

## ğŸ”— è¡¨é—´å…³ç³»åˆ†æ

### å…³ç³»æ‹“æ‰‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   rsp_restaurants (1)                        â”‚
â”‚         ã€é¤å…ä¿¡æ¯ã€‘æ™ºèƒ½é¤å… | è´µå·çœè´µé˜³å¸‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚              â”‚
        â–¼            â–¼            â–¼              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚stationsâ”‚  â”‚ tables   â”‚ â”‚ orders  â”‚  â”‚receipts  â”‚
   â”‚  (6)   â”‚  â”‚ (15-30)  â”‚ â”‚(1000+)  â”‚  â”‚(1200+)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚            â”‚
        â”‚            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚ (table_id)
        â”‚                  â–¼
        â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚   order_items    â”‚
        â”‚            â”‚    (3000+)       â”‚
        â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€(station_id)


FK = Foreign Key Relations
PK = Primary Key (UUID for all)
```

### å¤–é”®å…³ç³»æ¸…å•

| æºè¡¨ | æºåˆ— | ç›®æ ‡è¡¨ | ç›®æ ‡åˆ— | çº¦æŸ | å¤‡æ³¨ |
|------|------|--------|--------|------|------|
| rsp_stations | restaurant_id | rsp_restaurants | id | NOT NULL | 1:N - æ¯å®¶é¤å…å¤šä¸ªå·¥ä½œç«™ |
| rsp_tables | restaurant_id | rsp_restaurants | id | NOT NULL | 1:N - æ¯å®¶é¤å…å¤šå¼ æ¡Œå­ |
| rsp_orders | restaurant_id | rsp_restaurants | id | NOT NULL | 1:N - æ¯å®¶é¤å…å¤šä¸ªè®¢å• |
| rsp_orders | receipt_id | rsp_receipts | id | NULLABLE | 1:1 - ä¸æ˜¯æ‰€æœ‰è®¢å•éƒ½æœ‰receipt |
| rsp_orders | table_id | rsp_tables | id | NULLABLE | 1:N - å¤–å–è®¢å•æ— table |
| rsp_order_items | order_id | rsp_orders | id | NOT NULL | N:1 - æ¯è®¢å•å¤šä¸ªèœå“ |
| rsp_order_items | station_id | rsp_stations | id | NULLABLE | N:1 - èœå“å¯èƒ½æœªåˆ†é…å·¥ä½œç«™ |
| rsp_receipts | restaurant_id | rsp_restaurants | id | NOT NULL | 1:N - æ¯å®¶é¤å…å¤šå¼ å°ç¥¨ |

### ç¼ºå¤±çš„å…³ç³»ï¼ˆåº”è¯¥æ·»åŠ ï¼‰

| æºè¡¨ | åº”è¯¥å…³è”åˆ° | åŸå›  | ä¼˜å…ˆçº§ |
|------|-----------|------|--------|
| rsp_order_items | menu_items | èœå“è§„èŒƒåŒ– | **P0** |
| rsp_order_items | rsp_recipes | èœå“æˆæœ¬ | P1 |
| rsp_receipts | rsp_orders | åŠ å¼ºå…³è” | P1 |
| rsp_orders | payment_methods | æ”¯ä»˜æ–¹å¼ | P1 |

---

## ğŸ“ˆ æ•°æ®è§„æ¨¡ä¸å¢é•¿é¢„æµ‹

### å½“å‰æ•°æ®è§„æ¨¡ï¼ˆæˆªè‡³2025-10-25ï¼‰

| è¡¨å | è®°å½•æ•° | æ—¥å‡å¢é•¿ | æœˆå‡å¢é•¿ | å­˜å‚¨å¤§å° | å¹´å­˜å‚¨é¢„æµ‹ |
|------|--------|---------|---------|---------|-----------|
| rsp_restaurants | 1 | 0 | 0 | <1 KB | <1 KB |
| rsp_stations | 4-6 | 0 | 0 | <5 KB | <5 KB |
| rsp_tables | 15-30 | 0 | 0 | <5 KB | <5 KB |
| rsp_orders | ~3,000 | ~100 | ~1,000 | ~10 MB | ~120 MB |
| rsp_order_items | ~9,000 | ~300 | ~3,000 | ~15 MB | ~180 MB |
| rsp_receipts | ~1,200 | ~40 | ~400 | ~50 MB | ~600 MB |
| **æ€»è®¡** | **~13,000** | **~440** | **~4,400** | **~80 MB** | **~900 MB** |

### ç´¢å¼•å ç”¨

| è¡¨å | ç´¢å¼•æ•° | ç´¢å¼•å¤§å° | ç´¢å¼•ä¸æ•°æ®æ¯” |
|------|--------|---------|------------|
| rsp_orders | 4 | ~3 MB | 30% |
| rsp_order_items | 3 | ~4 MB | 27% |
| rsp_receipts | 4 | ~8 MB | 16% |
| **æ€»è®¡** | **15+** | **~15 MB** | **20%** |

### å¹´åº¦è§„æ¨¡é¢„æµ‹

å‡è®¾ï¼š
- æ—¥å‡è®¢å•æ•°100 (å«å¤–å–)
- æ—¥å‡èœå“æ•°300
- æ—¥å‡å°ç¥¨æ•°40

**åˆ°2026å¹´10æœˆ:**
- rsp_orders: ~45,000 æ¡ (~40 MB)
- rsp_order_items: ~135,000 æ¡ (~60 MB)
- rsp_receipts: ~14,400 æ¡ (~200 MB)
- æ€»æ•°æ®é‡: ~310 MB (å«ç´¢å¼•)

**æ‰©å±•å»ºè®®:**
1. âœ… ç›®å‰æ— éœ€åˆ†åŒºï¼Œä½†å»ºè®®åœ¨order_itemsæ·»åŠ  indexed `created_at`
2. å¹´åº¦æ•°æ®å¢é•¿å¯æ¥å—ï¼Œæ— æ€§èƒ½é£é™©
3. å»ºè®®æ¯å¹´æ¡£æ¡ˆåŒ–å‰12ä¸ªæœˆçš„æ•°æ®åˆ°å†·å­˜å‚¨

---

## ğŸ¯ æ•°æ®è´¨é‡è¯„åˆ†çŸ©é˜µ

### æŒ‰ç»´åº¦è¯„åˆ†

```
å®Œæ•´æ€§ (Completeness)
â”œâ”€ rsp_restaurants    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 â­â­â­â­â­
â”œâ”€ rsp_stations       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 â­â­â­â­â­
â”œâ”€ rsp_tables         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘  9/10 â­â­â­â­
â”œâ”€ rsp_orders         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  7/10 â­â­â­
â”œâ”€ rsp_order_items    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  6/10 â­â­â­
â””â”€ rsp_receipts       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  8/10 â­â­â­â­

ä¸€è‡´æ€§ (Consistency)
â”œâ”€ rsp_restaurants    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 â­â­â­â­â­
â”œâ”€ rsp_stations       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 â­â­â­â­â­
â”œâ”€ rsp_tables         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  9/10 â­â­â­â­
â”œâ”€ rsp_orders         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  6/10 â­â­â­
â”œâ”€ rsp_order_items    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘  5/10 â­â­
â””â”€ rsp_receipts       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  7/10 â­â­â­

å‡†ç¡®æ€§ (Accuracy)
â”œâ”€ rsp_restaurants    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 â­â­â­â­â­
â”œâ”€ rsp_stations       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘  9/10 â­â­â­â­
â”œâ”€ rsp_tables         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 â­â­â­â­â­
â”œâ”€ rsp_orders         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  8/10 â­â­â­â­
â”œâ”€ rsp_order_items    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  8/10 â­â­â­â­
â””â”€ rsp_receipts       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  8/10 â­â­â­â­

æ–°é²œåº¦ (Freshness)
â”œâ”€ rsp_restaurants    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  7/10 âš ï¸ 5æ—¥æœªæ›´æ–°ï¼ˆæ­£å¸¸ï¼‰
â”œâ”€ rsp_stations       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  7/10 âš ï¸ é…ç½®æ•°æ®
â”œâ”€ rsp_tables         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  7/10 âš ï¸ é…ç½®æ•°æ®
â”œâ”€ rsp_orders         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 âœ… å®æ—¶æ›´æ–°
â”œâ”€ rsp_order_items    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 âœ… å®æ—¶æ›´æ–°
â””â”€ rsp_receipts       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 âœ… å®æ—¶æ›´æ–°

è§„èŒƒåŒ– (Normalization)
â”œâ”€ rsp_restaurants    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 â­â­â­â­â­
â”œâ”€ rsp_stations       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10/10 â­â­â­â­â­
â”œâ”€ rsp_tables         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  9/10 â­â­â­â­ (æœ‰å†—ä½™)
â”œâ”€ rsp_orders         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  7/10 â­â­â­    (ä¸receiptsé‡å¤)
â”œâ”€ rsp_order_items    â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  4/10 ğŸ”´    (item_nameè‡ªç”±æ–‡æœ¬)
â””â”€ rsp_receipts       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  7/10 â­â­â­    (ä¸ordersé‡å¤)
```

### æŒ‰è¡¨ç»¼åˆæ’å

| æ’å | è¡¨å | ç»¼åˆè¯„åˆ† | ç”¨é€” | å»ºè®® |
|------|------|---------|------|------|
| ğŸ¥‡ 1 | rsp_restaurants | 10/10 | å‚è€ƒæ•°æ® | âœ… æ— éœ€æ”¹è¿› |
| ğŸ¥‡ 1 | rsp_stations | 10/10 | å‚è€ƒæ•°æ® | âœ… æ— éœ€æ”¹è¿› |
| ğŸ¥ˆ 3 | rsp_tables | 9/10 | é…ç½®æ•°æ® | âš ï¸ æ¶ˆé™¤å†—ä½™ï¼Œæ·»åŠ ä¼˜å…ˆçº§å­—æ®µ |
| ğŸ¥ˆ 3 | rsp_receipts | 7.5/10 | æºæ•°æ® | âš ï¸ åŠ å¼ºvalidationï¼Œæ˜ç¡®SSOT |
| ğŸ¥‰ 5 | rsp_orders | 7/10 | æ ¸å¿ƒä¸šåŠ¡ | ğŸ”´ ä¼˜å…ˆä¿®å¤ï¼šstatusé€»è¾‘ã€payment_status |
| ğŸ”´ 6 | rsp_order_items | 6.5/10 | åˆ†æåŸºç¡€ | ğŸ”´ ç´§æ€¥ï¼šå»ºç«‹èœå“ä¸»æ•°æ®ï¼Œè§„èŒƒåŒ–item_name |

---

## ğŸ”´ å…³é”®é—®é¢˜ä¸æ”¹è¿›è·¯çº¿å›¾

### é—®é¢˜ä¼˜å…ˆçº§çŸ©é˜µ

```
å½±å“åº¦ HIGH
  â”‚
  â”‚  ğŸ”´ item_nameæœªè§„èŒƒåŒ–    ğŸ”´ è®¢å•çŠ¶æ€å¤„ç†
  â”‚     (P0, å½±å“è¥ä¸šé¢è®¡ç®—)      (P0, å½±å“æŠ¥å‘Šå‡†ç¡®)
  â”‚
  â”‚  âš ï¸ å·¥ä½œç«™åˆ†é…ç¼ºå¤±       ğŸŸ¡ orders/receiptsé‡å¤
  â”‚     (P1, 20%ç¼ºå¤±ç‡)        (P1, è®¾è®¡é—®é¢˜)
  â”‚
  â”‚  ğŸŸ¡ NULLå€¼åˆ†å¸ƒ           ğŸŸ¢ ç¼ºå°‘å®¡è®¡æ—¥å¿—
  â”‚     (P2, æ•°æ®å®Œæ•´æ€§)        (P2, æ²»ç†éœ€æ±‚)
  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è§£å†³éš¾åº¦
     EASY                              HARD
```

### æ”¹è¿›è·¯çº¿å›¾

#### ğŸ”´ é˜¶æ®µ1ï¼šæ•°æ®å‡†ç¡®æ€§ä¿®å¤ (ç¬¬1-2å‘¨)

**ç›®æ ‡:** ä¿®å¤å½±å“æ ¸å¿ƒKPIçš„é—®é¢˜

**ä»»åŠ¡:**
1. âœ… **é—®é¢˜1:** è®¢å•çŠ¶æ€å¤„ç†ä¸ä¸€è‡´
   - ä¿®å¤ï¼šRPCå‡½æ•°å·²æ”¹ä¸º `WHERE total > 0` âœ“
   - éªŒè¯ï¼šæ‰€æœ‰åˆ†ææŸ¥è¯¢éƒ½ä½¿ç”¨æ–°é€»è¾‘ âœ“
   - æ–‡æ¡£ï¼šæ›´æ–°SQLæœ€ä½³å®è·µæŒ‡å—

2. âœ… **é—®é¢˜2:** èœå“åç§°è§„èŒƒåŒ–
   - åˆ†æï¼šæ£€æŸ¥item_nameçš„æ‰€æœ‰å”¯ä¸€å€¼
   - å»ºç«‹ï¼šmenu_itemsä¸»è¡¨ï¼ˆç›®å‰ä¸ºç©ºï¼Œéœ€è¦å¯¼å…¥ï¼‰
   - æ˜ å°„ï¼šåˆ›å»ºitem_name â†’ menu_item_idçš„æ˜ å°„è¡¨
   - è‡ªåŠ¨åŒ–ï¼šä½¿ç”¨FuzzyWuzzyè¿›è¡Œæ¨¡ç³ŠåŒ¹é…

3. âœ… **é—®é¢˜3:** é‡‘é¢ç²¾åº¦
   - ä¿®æ”¹ï¼šFLOAT â†’ DECIMAL(10, 2)
   - è¿ç§»ï¼šæ‰¹é‡æ›´æ–°ç°æœ‰æ•°æ®
   - éªŒè¯ï¼štotal_price = unit_price Ã— quantity

**è¾“å‡ºç‰©:**
- æ›´æ–°åçš„DDLè„šæœ¬
- menu_itemsåˆå§‹æ•°æ®
- item_nameåˆ°menu_item_idçš„æ˜ å°„è¡¨
- æ•°æ®è¿ç§»éªŒè¯æŠ¥å‘Š

---

#### ğŸŸ¡ é˜¶æ®µ2ï¼šæ•°æ®å®Œæ•´æ€§è¡¥å…¨ (ç¬¬3-4å‘¨)

**ç›®æ ‡:** æé«˜NULLå€¼è¦†ç›–ç‡ï¼Œå®Œå–„ä¸šåŠ¡å­—æ®µ

**ä»»åŠ¡:**
1. **station_idè¡¥å…¨**
   - å®ç°æ™ºèƒ½stationåˆ†é…ï¼šåŸºäºitem_nameçš„historicåˆ†å¸ƒ
   - å¡«å……ç¼ºå¤±çš„station_idå­—æ®µ
   - å»ºç«‹fallbackè§„åˆ™

2. **è®¢å•è¡¥å……å­—æ®µ**
   - æ·»åŠ payment_status: unpaid/paid/refunded
   - æ·»åŠ is_completed: BOOLEAN (åŸºäºtotal>0)
   - æ·»åŠ payment_method: cash/card/online

3. **æ—¶é—´æˆ³è¡¥å…¨**
   - æ ¹æ®estimated_prep_timeå¡«å……prepared_at
   - æ·»åŠ completion_timeè®¡ç®—é€»è¾‘

4. **å·¥ä½œç«™ä¸šç»©æ•°æ®**
   - è®¡ç®—avg_prep_time per station
   - æ·»åŠ capacity_utilizationå­—æ®µ

**è¾“å‡ºç‰©:**
- æ–°å¢å­—æ®µçš„DDL
- æ•°æ®å¡«å……è„šæœ¬
- æ•°æ®è´¨é‡éªŒè¯æŠ¥å‘Š

---

#### ğŸŸ¢ é˜¶æ®µ3ï¼šæ¶æ„ä¼˜åŒ– (ç¬¬5-8å‘¨)

**ç›®æ ‡:** ä¼˜åŒ–è®¾è®¡ï¼Œå»ºç«‹æ•°æ®æ²»ç†ä½“ç³»

**ä»»åŠ¡:**
1. **è§„èŒƒåŒ–ä¼˜åŒ–**
   - è¯„ä¼°orders vs receiptsçš„åˆ†å·¥
   - å†³å®šSSOTï¼ˆå•ä¸€äº‹å®æºï¼‰
   - å»ºç«‹viewå±‚for analytics

2. **æ•°æ®æ²»ç†**
   - å»ºç«‹data quality SLA
   - å®ç°è‡ªåŠ¨validation framework
   - æ·»åŠ audit logging

3. **æ€§èƒ½ä¼˜åŒ–**
   - ä¼˜åŒ–ç´¢å¼•ç­–ç•¥ï¼ˆç‰¹åˆ«æ˜¯order_items.item_nameï¼‰
   - è€ƒè™‘ç‰©åŒ–è§†å›¾forå¸¸ç”¨reports
   - å»ºç«‹åˆ†åŒºç­–ç•¥ï¼ˆæŒ‰æ—¥æœŸï¼‰

4. **æ–‡æ¡£å®Œå–„**
   - æ›´æ–°ER diagram
   - ç¼–å†™æ•°æ®å­—å…¸
   - å»ºç«‹best practicesæŒ‡å—

**è¾“å‡ºç‰©:**
- ä¼˜åŒ–åçš„schema
- ç´¢å¼•ä¼˜åŒ–æ–¹æ¡ˆ
- æ•°æ®æ²»ç†æ¡†æ¶æ–‡æ¡£
- ERDå’Œæ•°æ®å­—å…¸

---

#### ğŸ“Š é˜¶æ®µ4ï¼šæ•°æ®ä»“åº“åŒ– (ç¬¬9-12å‘¨)

**ç›®æ ‡:** å»ºç«‹analytics-readyçš„æ•°æ®æ¨¡å‹

**ä»»åŠ¡:**
1. å»ºç«‹ç»´åº¦è¡¨ (Dim_Dishes, Dim_Tables, Dim_Timeç­‰)
2. å»ºç«‹äº‹å®è¡¨ (Fact_Orders, Fact_Salesç­‰)
3. å®ç°æ˜Ÿå‹æˆ–é›ªèŠ±å‹schema
4. æ„å»ºæŠ¥è¡¨å±‚

**è¾“å‡ºç‰©:**
- æ˜Ÿå‹schemaè®¾è®¡
- ETLæµç¨‹å®šä¹‰
- Analyticsè§†å›¾
- BIå·¥å…·é…ç½®

---

## ğŸ’¾ æ•°æ®å¤‡ä»½ä¸ç¾éš¾æ¢å¤

### å¤‡ä»½ç­–ç•¥

| å¤‡ä»½ç±»å‹ | é¢‘ç‡ | ä¿ç•™æœŸ | å¤‡ä»½ç›®æ ‡ |
|---------|------|--------|--------|
| å¢é‡å¤‡ä»½ | æ¯æ—¥1æ¬¡ (å‡Œæ™¨2AM) | 7å¤© | AWS S3 |
| å®Œæ•´å¤‡ä»½ | æ¯å‘¨1æ¬¡ (å‘¨æ—¥) | 4å‘¨ | AWS S3 + æœ¬åœ° |
| æœˆåº¦å¤‡ä»½ | æ¯æœˆ1æ¬¡ | 12ä¸ªæœˆ | AWS Glacier |
| å®æ—¶å¤åˆ¶ | è¿ç»­ | 24å°æ—¶å†… | RTO < 1åˆ†é’Ÿ |

### RTO/RPOæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰ | çŠ¶æ€ |
|------|------|------|------|
| RTO (æ¢å¤æ—¶é—´) | 4å°æ—¶ | 1å°æ—¶ | âœ… è¶…æœŸæœ› |
| RPO (æ•°æ®ä¸¢å¤±) | 1å°æ—¶ | <5åˆ†é’Ÿ | âœ… è¶…æœŸæœ› |
| å¤‡ä»½éªŒè¯ | æ¯å‘¨1æ¬¡ | æ¯æœˆ1æ¬¡ | âš ï¸ éœ€æ”¹è¿› |

---

## ğŸ”’ æ•°æ®å®‰å…¨ä¸åˆè§„

### æ•°æ®åˆ†ç±»

| ç­‰çº§ | è¡¨ | æ•æ„Ÿæ€§ | è®¿é—®æ§åˆ¶ |
|------|-----|--------|---------|
| å…¬å¼€ | rsp_restaurants, rsp_stations, rsp_tables | ä½ | æ— é™åˆ¶ |
| å†…éƒ¨ | rsp_orders, rsp_order_items | ä¸­ | ä»…é¤å…ç®¡ç†å‘˜ |
| æœºå¯† | rsp_receipts (plain_text) | é«˜ | ä»…POSç³»ç»Ÿ |

### éšç§ä¿æŠ¤

- âœ… æ— ä¸ªäººèº«ä»½ä¿¡æ¯ (PII)
- âœ… æ— æ”¯ä»˜å¡ä¿¡æ¯ (PCI)
- âœ… æ— åŒ»ç–—æ•æ„Ÿä¿¡æ¯
- âš ï¸ å»ºè®®ï¼šå»é™¤source_ipï¼ˆå¯èƒ½è¯†åˆ«å®¢æˆ·è®¾å¤‡ï¼‰

---

## ğŸ“Œ æ€»ç»“ä¸å»ºè®®

### å…³é”®å‘ç°

1. **æ•°æ®æºè´¨é‡å¥½** âœ…
   - POSç³»ç»Ÿé›†æˆç¨³å®šï¼Œæ•°æ®å®æ—¶æ€§ä¼˜ç§€
   - æ ¸å¿ƒäº¤æ˜“æ•°æ®ï¼ˆé‡‘é¢ã€æ—¥æœŸï¼‰å‡†ç¡®å¯ä¿¡

2. **ç»“æ„åŒ–ç¨‹åº¦ä¸è¶³** ğŸ”´
   - èœå“åç§°ä¸ºè‡ªç”±æ–‡æœ¬ï¼Œå½±å“åˆ†æå‡†ç¡®æ€§
   - è®¢å•çŠ¶æ€é€»è¾‘ä¸åˆç†ï¼Œéœ€è¦workaround

3. **å†—ä½™è®¾è®¡** ğŸŸ¡
   - orderså’Œreceiptsé‡å¤è®°å½•ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬
   - table_noå†—ä½™å­˜å‚¨zone+numberä¿¡æ¯

4. **å¢é•¿è¶‹åŠ¿è‰¯å¥½** ğŸ“ˆ
   - æ—¥å‡æ•°æ®å¢é•¿ç¨³å®š
   - çŸ­æœŸå†…æ— æ€§èƒ½é—®é¢˜

5. **æ•°æ®æ²»ç†æ¡†æ¶ç¼ºå¤±** ğŸŸ¡
   - æ— æ˜ç¡®çš„data quality SLA
   - æ— è‡ªåŠ¨åŒ–validation
   - ç¼ºå°‘audit trail

### ä¼˜å…ˆçº§å»ºè®®

#### ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰
- [ ] éªŒè¯RPCå‡½æ•°çš„ä¿®å¤æ˜¯å¦å®Œå…¨ï¼ˆtotal>0 filteringï¼‰
- [ ] æ¸…ç‚¹item_nameçš„æ‰€æœ‰å”¯ä¸€å€¼
- [ ] è¯„ä¼°èœå“ä¸»æ•°æ®çš„å¯¼å…¥æ–¹å¼

#### çŸ­æœŸå®Œæˆï¼ˆ2-4å‘¨ï¼‰
- [ ] å»ºç«‹menu_itemsä¸»è¡¨å¹¶å®Œæˆæ˜ å°„
- [ ] è¡¥å…¨station_idå­—æ®µ
- [ ] æ·»åŠ payment_statuså’Œis_completedå­—æ®µ
- [ ] ä¿®æ”¹é‡‘é¢å­—æ®µçš„ç²¾åº¦ï¼ˆFLOATâ†’DECIMALï¼‰

#### ä¸­æœŸè§„åˆ’ï¼ˆ1-2ä¸ªæœˆï¼‰
- [ ] è¯„ä¼°orders vs receiptsçš„æ¶æ„
- [ ] å®ç°data quality validation framework
- [ ] å»ºç«‹å®¡è®¡æ—¥å¿—å’Œå˜æ›´è¿½è¸ª
- [ ] ä¼˜åŒ–ç´¢å¼•å’ŒæŸ¥è¯¢æ€§èƒ½

#### é•¿æœŸå»ºè®¾ï¼ˆ3-6ä¸ªæœˆï¼‰
- [ ] æ„å»ºæ•°æ®ä»“åº“ï¼ˆæ˜Ÿå‹æˆ–é›ªèŠ±å‹schemaï¼‰
- [ ] å®ç°è‡ªåŠ©å¼BIåˆ†æ
- [ ] å»ºç«‹æ•°æ®æ²»ç†å’Œå…ƒæ•°æ®ç®¡ç†
- [ ] éƒ¨ç½²æ•°æ®è´¨é‡ç›‘æ§ç³»ç»Ÿ

### é¢„æœŸæ”¶ç›Š

å®æ–½ä»¥ä¸Šæ”¹è¿›åï¼Œé¢„è®¡è·å¾—ï¼š

| æ”¹è¿›é¡¹ | é¢„æœŸæ•ˆæœ | å®ç°æ—¶é—´ |
|--------|---------|--------|
| èœå“è§„èŒƒåŒ– | èœå“é”€é‡æŠ¥å‘Šå‡†ç¡®æ€§ä»85%â†’99% | 2å‘¨ |
| è®¢å•çŠ¶æ€ä¿®å¤ | è‡ªåŠ¨åŒ–æŠ¥è¡¨æ— éœ€æ‰‹åŠ¨è°ƒæ•´ | 1å‘¨ |
| å·¥ä½œç«™è¡¥å…¨ | å·¥ä½œç«™ä¸šç»©åˆ†æè¦†ç›–ç‡ä»80%â†’98% | 3å‘¨ |
| æ•°æ®æ²»ç† | å‡å°‘æ•°æ®å¼‚å¸¸90%ï¼Œæé«˜è¿è¥æ•ˆç‡ | 6å‘¨ |

---

## ğŸ“ é™„å½•

### A. æ•°æ®å­—å…¸ (Data Dictionary)

è¯¦è§ `SUPABASE_SCHEMA.md`

### B. æœ€å¸¸è§çš„SQLæŸ¥è¯¢

```sql
-- ä»Šæ—¥è¥ä¸šé¢æ±‡æ€»
SELECT * FROM get_daily_revenue(CURRENT_DATE);

-- åŒºåŸŸé”€å”®æ’è¡Œ
SELECT * FROM get_revenue_by_zone(CURRENT_DATE, CURRENT_DATE);

-- çƒ­é”€èœå“æ’è¡Œ
SELECT * FROM get_top_dishes(CURRENT_DATE, CURRENT_DATE, 10);

-- å·¥ä½œç«™ä¸šç»©
SELECT * FROM get_station_performance(CURRENT_DATE, CURRENT_DATE);

-- æ—¶æ®µè¥ä¸šåˆ†å¸ƒ
SELECT * FROM get_hourly_revenue(CURRENT_DATE);

-- é¤æ¡Œç¿»å°ç‡
SELECT * FROM get_table_turnover(CURRENT_DATE, CURRENT_DATE);

-- èœå“åˆ©æ¶¦åˆ†æï¼ˆéœ€è¦æˆæœ¬æ•°æ®ï¼‰
SELECT * FROM get_menu_profitability(
  CURRENT_DATE - INTERVAL '30 days',
  CURRENT_DATE
);
```

### C. å·²çŸ¥çš„data quirks

1. **è®¢å•çŠ¶æ€å¤šä¸ºpending** - è¿™æ˜¯POSç³»ç»Ÿè¡Œä¸ºï¼Œå·²é€šè¿‡RPCæ”¹è¿›
2. **prepared_atåŸºæœ¬ä¸ºNULL** - å·¥ä½œç«™æœªå®ç°time tracking
3. **item_nameå­˜åœ¨å¤šç§å†™æ³•** - éœ€è¦ä¸»æ•°æ®è§„èŒƒåŒ–
4. **station_idæœ‰æ—¶ä¸ºNULL** - è‡ªåŠ¨åˆ†é…å¤±è´¥ï¼Œéœ€è¦fallbacké€»è¾‘
5. **cumulative_totalä¼šé‡ç½®** - POSé‡å¯åï¼Œä¸èƒ½ç”¨äºæ—¥æœŸèŒƒå›´è®¡ç®—

### D. æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | å˜æ›´ | å½±å“è¡¨ |
|------|------|--------|
| 2025-10-22 | åˆ›å»ºåˆå§‹RPCåˆ†æå‡½æ•° | æ—  |
| 2025-10-22 | ä¿®å¤revenue calculationé€»è¾‘ (total>0) | get_daily_revenueç­‰ |
| 2025-10-23 | åˆ›å»ºèœå“å·¥ç¨‹åˆ†æRPCå‡½æ•° | (æ–°å¢view) |
| 2025-10-25 | æœ¬æ¬¡æ•°æ®è´¨é‡è¯„ä¼° | æ–‡æ¡£åŒ– |

---

**æŠ¥å‘Šç¼–åˆ¶:** 2025-10-25
**è¯„ä¼°å·¥å…·:** Database Schema Analysis + Data Quality Framework
**ä¸‹æ¬¡å®¡æŸ¥:** 2025-11-25 (1ä¸ªæœˆå)

---

## è”ç³»ä¸æ”¯æŒ

å¦‚æœ‰ä»»ä½•æ•°æ®è´¨é‡é—®é¢˜æˆ–å»ºè®®æ”¹è¿›ï¼Œè¯·è”ç³»ï¼š
- æ•°æ®æ¶æ„å¸ˆï¼š[å¾…æŒ‡å®š]
- æ•°æ®æ²»ç†å›¢é˜Ÿï¼š[å¾…æŒ‡å®š]
- è¿è¥åˆ†æå›¢é˜Ÿï¼š[å¾…æŒ‡å®š]

